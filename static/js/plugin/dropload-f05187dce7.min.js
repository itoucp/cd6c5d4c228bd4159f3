!function(e){"use strict";var t=window,n=document,d=e(t),i=e(n),s=(e.fn.dropload=function(o){return new s(this,o)},function(o,t){var n=this;(window.__MyDropLoad=n).$element=o,n.upInsertDOM=!1,n.loading=!1,n.isLockUp=!1,n.isLockDown=!1,n.isData=!0,n._scrollTop=0,n._threshold=0,n.init(t)});function l(o){o.touches||(o.touches=o.originalEvent.touches)}function a(o){o.opts.autoLoad&&""!=o.opts.loadDownFn&&o._scrollContentHeight-o._threshold<=o._scrollWindowHeight&&c(o)}function r(o){o.opts.scrollArea==t?o._scrollContentHeight=i.height():o._scrollContentHeight=o.$element[0].scrollHeight}function c(o){o.direction="up",o.$domDown.html(o.opts.domDown.domLoad),o.loading=!0,o.opts.loadDownFn(o)}function p(o,t){try{o.css({"-webkit-transition":"all "+t+"ms",transition:"all "+t+"ms"})}catch(o){}}s.prototype.init=function(o){var s=this;s.opts=e.extend(!0,{},{scrollArea:s.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>',domNoData:'<div class="dropload-noData">暂无数据</div>'},autoLoad:!0,distance:50,threshold:"",loadUpFn:"",loadDownFn:""},o),""!=s.opts.loadDownFn&&(s.$element.append('<div class="'+s.opts.domDown.domClass+'">'+s.opts.domDown.domRefresh+"</div>"),s.$domDown=e("."+s.opts.domDown.domClass)),s.$domDown&&""===s.opts.threshold?s._threshold=Math.floor(+s.$domDown.height()/3):s._threshold=s.opts.threshold,s.opts.scrollArea==t?(s.$scrollArea=d,s._scrollContentHeight=i.height(),s._scrollWindowHeight=n.documentElement.clientHeight):(s.$scrollArea=s.opts.scrollArea,s._scrollContentHeight=s.$element[0].scrollHeight,s._scrollWindowHeight=s.$element.height()),a(s),d.on("resize",function(){s.opts.scrollArea==t?s._scrollWindowHeight=t.innerHeight:s._scrollWindowHeight=s.$element.height()}),s.$element.on("touchstart",function(o){var t;s.loading||(l(o),(t=s)._startY=o.touches[0].pageY,t.touchScrollTop=t.$scrollArea.scrollTop())}),s.$element.on("touchmove",function(o){var t,n;s.loading||(l(o),o=o,(t=s)._curY=o.touches[0].pageY,t._moveY=(t._curY-t._startY)/2,0<t._moveY?t.direction="down":t._moveY<0&&(t.direction="up"),n=Math.abs(t._moveY),""!=t.opts.loadUpFn&&t.touchScrollTop<=0&&"down"==t.direction&&!t.isLockUp&&(o.preventDefault(),t.$domUp=e("."+t.opts.domUp.domClass),t.upInsertDOM||(t.$element.prepend('<div class="'+t.opts.domUp.domClass+'"></div>'),t.upInsertDOM=!0),p(t.$domUp,0),n<=t.opts.distance?(t._offsetY=n,t.$domUp.html(t.opts.domUp.domRefresh)):n>t.opts.distance&&n<=2*t.opts.distance?(t._offsetY=t.opts.distance+.5*(n-t.opts.distance),t.$domUp.html(t.opts.domUp.domUpdate)):t._offsetY=t.opts.distance+.5*t.opts.distance+.2*(n-2*t.opts.distance),t.$domUp.css({height:t._offsetY})))}),s.$element.on("touchend",function(){if(!s.loading){var o=s,t=Math.abs(o._moveY);if(""!=o.opts.loadUpFn&&o.touchScrollTop<=0&&"down"==o.direction&&!o.isLockUp){if(p(o.$domUp,300),t>o.opts.distance)try{o.$domUp&&o.$domUp.css({height:o.$domUp.children().height()}),o.$domUp&&o.$domUp.html(o.opts.domUp.domLoad),o.loading=!0,o.opts.loadUpFn(o)}catch(o){console.table(o)}else try{o.$domUp&&o.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){o.upInsertDOM=!1,e(this).remove()})}catch(o){console.table(o)}o._moveY=0}}}),s.$scrollArea.on("scroll",function(){s._scrollTop=s.$scrollArea.scrollTop(),""!=s.opts.loadDownFn&&!s.loading&&!s.isLockDown&&s._scrollContentHeight-s._threshold<=s._scrollWindowHeight+s._scrollTop&&c(s)})},s.prototype.destroy=function(){var o=this;d.off("resize"),o.$element.off(),o.$scrollArea.off("scroll"),o.$domDown&&o.$domDown.remove(),window.__MyDropLoad=null},s.prototype.lock=function(o){var t=this;void 0===o?"up"==t.direction?t.isLockDown=!0:"down"==t.direction?t.isLockUp=!0:(t.isLockUp=!0,t.isLockDown=!0):"up"==o?t.isLockUp=!0:"down"==o&&(t.isLockDown=!0,t.direction="up")},s.prototype.unlock=function(){var o=this;o.isLockUp=!1,o.isLockDown=!1,o.direction="up"},s.prototype.noData=function(o){void 0===o||1==o?this.isData=!1:0==o&&(this.isData=!0)},s.prototype.resetload=function(){var o=this;"down"==o.direction&&o.upInsertDOM?o.$domUp.css({height:"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){o.loading=!1,o.upInsertDOM=!1,e(this).remove(),r(o)}):"up"==o.direction&&(o.loading=!1,o.isData?(o.$domDown.html(o.opts.domDown.domRefresh),r(o),a(o)):o.$domDown.html(o.opts.domDown.domNoData))}}(window.Zepto||window.jQuery);