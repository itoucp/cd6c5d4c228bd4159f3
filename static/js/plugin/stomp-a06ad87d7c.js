!function(){var m,n,d,a,s,g,o={}.hasOwnProperty,r=[].slice;function y(t,e,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=n?n:""}function t(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}m={LF:"\n",NULL:"\0"},y.prototype.toString=function(){var t,e,n,i=[this.command],r=!1===this.headers["content-length"];for(t in r&&delete this.headers["content-length"],n=this.headers)o.call(n,t)&&(e=n[t],i.push(t+":"+e));return this.body&&!r&&i.push("content-length:"+y.sizeOfUTF8(this.body)),i.push(m.LF+this.body),i.join(m.LF)},y.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},s=function(t){for(var e,n,i,r,o,s,a,u,c=t.search(RegExp(""+m.LF+m.LF)),h=t.substring(0,c).split(m.LF),p=h.shift(),f={},l=function(t){return t.replace(/^\s+|\s+$/g,"")},d=h.reverse(),g=0,b=d.length;g<b;g++)r=(o=d[g]).indexOf(":"),f[l(o.substring(0,r))]=l(o.substring(r+1));if(e="",s=c+2,f["content-length"])h=parseInt(f["content-length"]),e=(""+t).substring(s,s+h);else for(i=a=s,u=t.length;(s<=u?a<u:u<a)&&(n=t.charAt(i))!==m.NULL;i=s<=u?++a:--a)e+=n;return new y(p,f,e)},y.unmarshall=function(t){var r,e,o=t.split(RegExp(""+m.NULL+m.LF+"*")),t={frames:[],partial:""};return t.frames=function(){for(var t=o.slice(0,-1),e=[],n=0,i=t.length;n<i;n++)r=t[n],e.push(s(r));return e}(),(e=o.slice(-1)[0])===m.LF||-1!==e.search(RegExp(""+m.NULL+m.LF+"*$"))?t.frames.push(s(e)):t.partial=e,t},y.marshall=function(t,e,n){return new y(t,e,n).toString()+m.NULL},d=y,t.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window&&null!=(e=window.console)?e.log(t):void 0},g=function(){return Date.now?Date.now():(new Date).valueOf},t.prototype._transmit=function(t,e,n){var i=d.marshall(t,e,n);for("function"==typeof this.debug&&this.debug(">>> "+i);;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+i.length)}},t.prototype._setupHeartbeat=function(r){var e,o,t,n,i,s;if((i=r.version)===a.VERSIONS.V1_1||i===a.VERSIONS.V1_2)return n=(i=function(){for(var t=r["heart-beat"].split(","),e=[],n=0,i=t.length;n<i;n++)o=t[n],e.push(parseInt(o));return e}())[0],i=i[1],0!==this.heartbeat.outgoing&&0!==i&&(e=Math.max(this.heartbeat.outgoing,i),"function"==typeof this.debug&&this.debug("send PING every "+e+"ms"),this.pinger=a.setInterval(e,(t=this,function(){return t.ws.send(m.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==n?(e=Math.max(this.heartbeat.incoming,n),"function"==typeof this.debug&&this.debug("check PONG every "+e+"ms"),this.ponger=a.setInterval(e,(s=this,function(){var t=g()-s.serverActivity;if(2*e<t)return"function"==typeof s.debug&&s.debug("did not receive server activity for the last "+t+"ms"),s.ws.close()}))):void 0},t.prototype._parseConnect=function(){var t,e,n=1<=arguments.length?r.call(arguments,0):[],i={};switch(n.length){case 2:i=n[0],t=n[1];break;case 3:n[1]instanceof Function?(i=n[0],t=n[1],e=n[2]):(i.login=n[0],i.passcode=n[1],t=n[2]);break;case 4:i.login=n[0],i.passcode=n[1],t=n[2],e=n[3];break;default:i.login=n[0],i.passcode=n[1],t=n[2],e=n[3],i.host=n[4]}return[i,t,e]},t.prototype.connect=function(){var f,l,e,t,n=1<=arguments.length?r.call(arguments,0):[],n=this._parseConnect.apply(this,n),i=n[0];return this.connectCallback=n[1],f=n[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=(l=this,function(t){var i,r,e,n,o,s,a,u,c,h,p,t="undefined"!=typeof ArrayBuffer&&t.data instanceof ArrayBuffer?(i=new Uint8Array(t.data),"function"==typeof l.debug&&l.debug("--- got data length: "+i.length),function(){for(var t=[],e=0,n=i.length;e<n;e++)r=i[e],t.push(String.fromCharCode(r));return t}().join("")):t.data;if(l.serverActivity=g(),t!==m.LF){for("function"==typeof l.debug&&l.debug("<<< "+t),t=d.unmarshall(l.partialData+t),l.partialData=t.partial,p=[],u=0,c=(h=t.frames).length;u<c;u++)switch((n=h[u]).command){case"CONNECTED":"function"==typeof l.debug&&l.debug("connected to server "+n.headers.server),l.connected=!0,l._setupHeartbeat(n.headers),p.push("function"==typeof l.connectCallback?l.connectCallback(n):void 0);break;case"MESSAGE":a=n.headers.subscription,(s=l.subscriptions[a]||l.onreceive)?(e=l,o=n.headers["message-id"],n.ack=function(t){return e.ack(o,a,t=null==t?{}:t)},n.nack=function(t){return e.nack(o,a,t=null==t?{}:t)},p.push(s(n))):p.push("function"==typeof l.debug?l.debug("Unhandled received MESSAGE: "+n):void 0);break;case"RECEIPT":p.push("function"==typeof l.onreceipt?l.onreceipt(n):void 0);break;case"ERROR":p.push("function"==typeof f?f(n):void 0);break;default:p.push("function"==typeof l.debug?l.debug("Unhandled frame: "+n):void 0)}return p}"function"==typeof l.debug&&l.debug("<<< PONG")}),this.ws.onclose=(e=this,function(){var t="Whoops! Lost connection to "+e.ws.url;return"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof f?f(t):void 0}),this.ws.onopen=(t=this,function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),i["accept-version"]=a.VERSIONS.supportedVersions(),i["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",i)})},t.prototype.disconnect=function(t,e){return this._transmit("DISCONNECT",e=null==e?{}:e),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},t.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&a.clearInterval(this.pinger),this.ponger)return a.clearInterval(this.ponger)},t.prototype.send=function(t,e,n){return null==n&&(n=""),(e=null==e?{}:e).destination=t,this._transmit("SEND",e,n)},t.prototype.subscribe=function(t,e,n){var i;return(n=null==n?{}:n).id||(n.id="sub-"+this.counter++),n.destination=t,this.subscriptions[n.id]=e,this._transmit("SUBSCRIBE",n),i=this,{id:n.id,unsubscribe:function(){return i.unsubscribe(n.id)}}},t.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},t.prototype.begin=function(t){var e,n=t||"tx-"+this.counter++;return this._transmit("BEGIN",{transaction:n}),e=this,{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}},t.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},t.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},t.prototype.ack=function(t,e,n){return(n=null==n?{}:n)["message-id"]=t,n.subscription=e,this._transmit("ACK",n)},t.prototype.nack=function(t,e,n){return(n=null==n?{}:n)["message-id"]=t,n.subscription=e,this._transmit("NACK",n)},n=t,a={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,e){return null==e&&(e=["v10.stomp","v11.stomp"]),t=new(a.WebSocketClass||WebSocket)(t,e),new n(t)},over:function(t){return new n(t)},Frame:d},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=a),"undefined"!=typeof window&&null!==window?(a.setInterval=function(t,e){return window.setInterval(e,t)},a.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=a):exports||(self.Stomp=a)}.call(this);