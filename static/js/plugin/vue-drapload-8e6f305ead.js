!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):o(t.Drapload=t.Drapload||{})}(this,function(t){"use strict";function m(t,o){t&&o&&new Function("scope","return "+("scope."+o)+";")(t)}function i(t){for(var o=t.parentNode;o;){if("HTML"===o.tagName)return 1;if(11===o.nodeType)return;o=o.parentNode}}var p=function(t){return(t||document.documentElement).scrollTop};function h(t){t.touches||(t.touches=t.originalEvent.touches)}function e(t,o){for(var n in o)t[n]=o[n]}function l(t){var u=t;return{_options:{},scrollTop:0,_initConfig:function(){var t,o,n=this;this.__initConfig||(this.__initConfig=!0,t=u.elm,n.directive=u,n.element=t,n.isData=!0,n._options={key:"scroll_"+parseInt(10*Math.random()),domUp:{dom:null,domClass:"dropload-up",initialCall:function(){},pullingCall:function(){},loadingCall:function(){},loadEndCall:function(){}},domDown:{dom:null,domClass:"dropload-down",initialCall:function(){},loadingCall:function(){},domNoData:function(){}},loadUpFn:"",loadDownFn:""},e(n._options.domUp,n.baseConfig.domUp),e(n._options.domDown,n.baseConfig.domDown),(o=t.getAttribute("drapload-key"))&&((u.context[o]=n)._options.key=o),n._options.loadUpFn=t.getAttribute("drapload-up"),n._options.loadDownFn=t.getAttribute("drapload-down"))},_initDom:function(){var t,o,n;this.__initDom||(this.__initDom=!0,t=this._options,n=(o=this.element).firstElementChild,1!=o.childElementCount?console.error("滚动元素最好只有一个孩子节点"):(t.loadUpFn&&(t.domUp.dom=document.createElement("div"),t.domUp.dom.setAttribute("class",t.domUp.domClass),t.domUp.initialCall(),o.insertBefore(t.domUp.dom,n),t.domUp.getDistance=function(){return t.domUp.dom.firstElementChild.clientHeight}),t.loadDownFn&&(t.domDown.dom=document.createElement("div"),t.domDown.dom.setAttribute("class",t.domDown.domClass),t.domDown.initialCall(),o.appendChild(t.domDown.dom),t.domDown.getDistance=function(){return t.domDown.dom.firstElementChild.clientHeight})))},_initEvent:function(){var t,o,n,i,e,l,a,d,s,c=this;function r(){t.apply(l,a),i=n}!this.__initEvent&&(this.__initEvent=!0,d=c.element,(s=c._options).loadUpFn&&(c.touchstartCall=function(t){c.loading||(h.call(c,t),function(t){var o=this;o._startY=t.touches[0].pageY,o.touchScrollTop=p(o.element)}.call(c,t))},c.touchmoveCall=function(t){c.loading||(h.call(c,t),function(t){var o=this,n=o._options,i=n.domUp,e=(o._curY=t.touches[0].pageY,o._moveY=(o._curY-o._startY)/2,0<o._moveY?o.direction="up":o._moveY<0&&(o.direction="down"),Math.abs(o._moveY));""!=n.loadUpFn&&o.touchScrollTop<=0&&"up"==o.direction&&(t.preventDefault(),f(i.dom,0),e<=i.getDistance()||(e=e>i.getDistance()&&e<=2*i.getDistance()?i.getDistance()+.5*(e-i.getDistance()):i.getDistance()+.5*i.getDistance()+.2*(e-2*i.getDistance())),i.dom.style.height=e+"px",i.pullingCall(e))}.call(c,t))},c.touchendCall=function(){c.loading||!function(){var t=this,o=t._options,n=o.domUp,i=Math.abs(t._moveY);if(t.touchScrollTop<=0&&"up"==t.direction)try{f(o.domUp.dom,300),i>o.domUp.getDistance()?(n.dom.style.height=o.domUp.getDistance()+"px",n.loadingCall(),t.loading=!0,m(t.directive.context,o.loadUpFn)):n.dom.style.height="0px"}catch(t){console.table(t)}t._moveY=0}.call(c)},d.addEventListener("touchmove",c.touchmoveCall),d.addEventListener("touchstart",c.touchstartCall),d.addEventListener("touchend",c.touchendCall)),s.loadDownFn&&(c.scrollListener=(t=c.doCheck.bind(c),o=200,function(){var t;l=this,a=arguments,n=Date.now(),e&&(clearTimeout(e),e=null),!i||(t=o-(n-i))<0?r():e=setTimeout(function(){r()},t)}),d.addEventListener("scroll",c.scrollListener)),s=!1,(d=d.getAttribute("drapload-initialize"))&&(s=Boolean(u.context[d])),u.initialize=s)&&c.doCheck()},noData:function(){this.isData=!1},hasData:function(){this.isData=!0},resetload:function(){var t=this._options;this.loading=!1,"up"==this.direction&&(f(t.domUp.dom,300),t.domUp.dom.style.height="0px",t.domUp.loadEndCall()),this.isData?t.domDown.initialCall():t.domDown.domNoData()},doBind:function(){this.binded||(this.binded=!0,this._initConfig(),this._initDom(),this._initEvent())},doCheck:function(t){var o=this,n=o.element,i=o._options;o.scrollTop=p(n),(n||document.documentElement).offsetHeight+o.scrollTop+20>=(n||document.documentElement).scrollHeight&&i.loadDownFn&&o.isData&&(i.domDown.loadingCall(),m(o.directive.context,i.loadDownFn))},setScrollTop:function(t){var o=this.element;o&&(o.scrollTop=t)},bind:function(t){var o=this,n=u.elm;o.baseConfig=t||{},u.context.$on("hook:ready",function(){i(n)&&o.doBind()}),u.context.$on("hook:attached",function(){o.setScrollTop(o.scrollTop)}),this.bindTryCount=0,function t(){10<u.bindTryCount||(u.bindTryCount++,i(n)?o.doBind():setTimeout(t,50))}()},unbind:function(){var t=this,t=(t.scrollListener&&t.element.removeEventListener("scroll",t.scrollListener),t.touchstartCall&&t.element.removeEventListener("touchstart",t.touchstartCall),t.touchmoveCall&&t.element.removeEventListener("touchmove",t.touchmoveCall),t.touchendCall&&t.element.removeEventListener("touchend",t.touchendCall),t._options.key);t&&delete u.context[t]}}}function f(t,o){t&&t.transNum!=o&&(t.transNum=o,t.style.transition="all "+o+"ms",t.style.webkitTransition="all "+o+"ms")}var a={domUp:{initialCall:function(){try{this.dom.innerHTML='<div class="dropload-refresh">↓下拉刷新</div>'}catch(t){}},loadingCall:function(){try{this.dom.innerHTML='<div class="dropload-load"><span class="loading"></span>加载中...</div>'}catch(t){}},loadEndCall:function(){try{this.dom.innerHTML='<div class="dropload-load">加载完成</div>'}catch(t){}},pullingCall:function(t){var o=this;if(t<=o.getDistance())o.initialCall();else if(t>o.getDistance()&&t<=2*o.getDistance())try{o.dom.innerHTML='<div class="dropload-update">↑松开刷新</div>'}catch(t){}}},domDown:{initialCall:function(){try{this.dom.innerHTML='<div class="dropload-refresh">向上拖动加载更多</div>'}catch(t){}},loadingCall:function(){try{this.dom.innerHTML='<div class="dropload-load"><span class="loading"></span>加载中...</div>'}catch(t){}},domNoData:function(){try{this.dom.innerHTML='<div class="dropload-refresh">已加载全部内容</div>'}catch(t){}}}};function o(t,o){(o=o||{}).domUp&&e(a.domUp,o.domUp),o.domDown&&e(a.domDown,o.domDown),t.directive("Drapload",{bind:function(t,o,n){n.scroll=new l(n),n.scroll.bind(a)},unbind:function(t,o,n){n.scroll&&n.scroll.unbind()}})}l.install=o,window.Vue&&(window.Drapload=l,Vue.use(o)),t.install=o,t.Drapload=l});